window.ConBoard=window.ConBoard||{},window.ConBoard.Api={},ConBoard.Api.GetCats=function(t,e){var o=new ConBoard.Request("GET","/categories/",function(o,i){ConBoard.Api._return(o,i,t,e)});return o.send(),o},ConBoard.Api.GetList=function(t,e,o){var i=new ConBoard.Request("GET","/programmes/location/"+t+"/",function(t,i){ConBoard.Api._return(t,i,e,o)});return i.send(),i},ConBoard.Api.GetProgramme=function(t,e,o){var i=new ConBoard.Request("GET","/programmes/"+t+"/",function(t,i){ConBoard.Api._return(t,i,e,o)});return i.send(),i},ConBoard.Api.GetAllProgrammes=function(t,e){var o=new ConBoard.Request("GET","/programmes/",function(o,i){ConBoard.Api._return(o,i,t,e)});return o.send(),o},ConBoard.Api._return=function(t,e,o,i){var n,r;if(i=i||window,!t&&e){try{n=JSON.parse(e)}catch(a){r=a}o.call(i,r,n)}else o.call(i,t,void 0)},window.ConBoard=window.ConBoard||{},ConBoard.DayEnum=["Neděle","Pondělí","Uterý","Středa","Čtvrtek","Pátek","Sobota"],ConBoard.DeltaToString=function(t){var e=t%1e3;t=(t-e)/1e3;var o=t%60;t=(t-o)/60;var i=t%60,n=(t-i)/60;return(n>0?n+":":"")+(i>0||n>0?(10>i?"0"+i:i)+":":"")+(10>o?"0"+o:o)},ConBoard.TickDiff=function(t,e){return t>e?t-e:e-t},ConBoard.Board=function(t,e){this.resolution=e.resolution,this.interval=e.interval,this.timeDelay=e.timeDelay,this.notices=e.notices,this.minutes,this.cats=[],this.container=t,this.container.style.width=document.body.clientWidth,this.createHead(),this.createBody(),this.getCats(),this.startTimer()},ConBoard.Board.prototype.createHead=function(){this.head=new ConBoard.Head({resolution:this.resolution,interval:this.interval}),this.container.appendChild(this.head.getEl())},ConBoard.Board.prototype.createBody=function(){this.body=new ConBoard.Body({catKey:this.catKey,timeDelay:this.timeDelay},this.notices),this.container.appendChild(this.body.getEl())},ConBoard.Board.prototype.tick=function(t){t.startTick=t.tick-t.tick%this.interval,t.endTick=t.startTick+this.resolution*this.interval;var e=t.minutes>30?30:0;t.startMinutes=e,this.head.update(t),this.body.update(t),this.body.masked>0?this.head.hideLine():this.head.hidenLine&&0===this.body.masked&&this.head.showLine()},ConBoard.Board.prototype.startTimer=function(){this.timer=new ConBoard.Timer(500),this.timer.on(this.tick,this),this.timer.Start()},ConBoard.Board.prototype.getCats=function(){{var t=this;ConBoard.Api.GetCats(function(e,o){t.loadCats(o)})}},ConBoard.Board.prototype.loadCats=function(t){for(var e in t)this.body.createCat({name:t[e],id:e,resolution:this.resolution,interval:this.interval,key:"location"})},window.ConBoard=window.ConBoard||{},ConBoard.Body=function(t,e){this.config=t,this.notices=e,this.masked=0,this.cats=[],this.createEl()},ConBoard.Body.prototype.update=function(t){for(var e=this.cats.length-1;e>=0;e--)this.cats[e].update(t);if(this.notices)for(var e=0;e<this.notices.length;e++){var o=this.notices[e];o.start<t.tick&&o.end>t.tick?o.rendered?o.update():(o.create(),this.el.appendChild(o.getEl()),this.masked++):o.end<t.tick&&o.rendered&&(o.destroy(),this.masked--)}},ConBoard.Body.prototype.getEl=function(){return this.el},ConBoard.Body.prototype.createEl=function(){this.el=document.createElement("div"),this.el.setAttribute("class","con-board-body")},ConBoard.Body.prototype.getCat=function(){return this.cats[i]||{}},ConBoard.Body.prototype.getCatCount=function(){return this.cats.length},ConBoard.Body.prototype.createCat=function(t){var e=new ConBoard.Cat({name:t.name,id:this.cats.length,resolution:t.resolution,interval:t.interval});this.cats.push(e),this.el.appendChild(e.getEl()),this.loadCat(e)},ConBoard.Body.prototype.loadCat=function(t){ConBoard.Api.GetList(t.name,function(e,o){t.fillCat(o)})},window.ConBoard=window.ConBoard||{},ConBoard.Cat=function(t){this.name=t.name,this.id=t.id,this.resolution=t.resolution,this.interval=t.interval,this.loading=!1,this.progIndex=0,this.tillStart,this.content=[],this.progs=[],this.markers=[],this.createEl()},ConBoard.Cat.prototype.getProgCount=function(){return this.progs.length},ConBoard.Cat.prototype.fillCat=function(t){this.content=t,this.content.sort(function(t,e){return t.startTime<e.startTime?-1:1}),this.dirty=!0},ConBoard.Cat.prototype.update=function(t){for(var e=this.progIndex;e<this.content.length;e++)this.content[e].endTime<t.startTick&&(this.progIndex=e+1);(this.dirty||t.startTick!==this.startTick)&&(this.dirty=!1,this.startTick=t.startTick,this.progIndex>=this.content.length||(0===this.progs.length&&this.content.length&&this.content[this.progIndex].startTime>t.endTick&&(this.tillStart=ConBoard.TickDiff(t.tick,this.content[this.progIndex].startTime)),this.updateBody(t)))},ConBoard.Cat.prototype.updateBody=function(t){for(var e=0;e<this.progs.length;e++)this.progs[e].endTime<=t.startTick&&(this.progs[e].destroy(),this.progs.splice(e,1),e--);for(var e=this.progIndex;e<this.content.length&&(this.content[e].endTime>t.startTick&&this.content[e].startTime<t.endTick&&!this.content[e].rendered&&(this.createProgramme(this.content[e],t),this.content[e].rendered=!0),!(t.endTick<this.content[e].startTime));e++);for(var e=0;e<this.progs.length;e++){var o=this.progs[e],i=(o.endTime-o.startTime)/this.interval*(100/this.resolution),n=(o.startTime-t.startTick)/this.interval*(100/this.resolution);0>=n&&n+i>=100?(n=0,i=100):0>=n?(i+=n,n=0):n+i>100&&(i=100-n),o.updatePosition(n),o.setWidth(i)}},ConBoard.Cat.prototype.createProgramme=function(t){var e=new ConBoard.Programme(t);ConBoard.Api.GetProgramme(t.pid,function(t,o){!t&&o&&e.setDetails(o)},this),this.progs.push(e),this.body.appendChild(e.getEl())},ConBoard.Cat.prototype.getEl=function(){return this.el},ConBoard.Cat.prototype.createEl=function(){var t=document.createElement("div");t.setAttribute("class","con-board-cat"),t.setAttribute("id","con-board-cat-"+this.id),this.el=t;var e=document.createElement("div");e.setAttribute("class","con-board-cat-head"),e.innerHTML=this.name,this.head=e;var o=document.createElement("div");o.setAttribute("class","con-board-cat-body"),this.body=o,this.el.appendChild(e),this.el.appendChild(o);for(var i=0;i<this.resolution;i++){var n=this.createMarker();n.setAttribute("class",n.getAttribute("class")+" marker-"+i),this.markers.push(n),o.appendChild(n)}return t},ConBoard.Cat.prototype.createMarker=function(){var t=document.createElement("div");return t.setAttribute("class","con-board-cat-body-marker"),t},window.ConBoard=window.ConBoard||{},ConBoard.Head=function(t){this.resolution=t.resolution,this.interval=t.interval,this.pieces=[],this.createEl(),this.lineEl.innerHTML;for(var e=0;e<this.resolution;e++){var o=this.createPiece(e);this.pieces.push(o),this.lineEl.appendChild(o)}this.hidenLine=!1},ConBoard.Head.prototype.hideLine=function(){this.lineEl.style.visibility="hidden",this.hidenLine=!0},ConBoard.Head.prototype.showLine=function(){this.lineEl.style.visibility="visible",this.hidenLine=!1},ConBoard.Head.prototype.getEl=function(){return this.el},ConBoard.Head.prototype.createEl=function(){var t=document.createElement("div"),e=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div");t.setAttribute("class","con-board-head"),o.setAttribute("class","con-board-head-line"),e.setAttribute("class","con-board-head-time"),i.setAttribute("class","con-board-head-logo"),t.appendChild(i),t.appendChild(o),t.appendChild(e),this.logo=i,this.lineEl=o,this.timeEl=e,this.el=t},ConBoard.Head.prototype.createPiece=function(){var t=document.createElement("div");return t.setAttribute("class","con-board-head-line-piece"),t},ConBoard.Head.prototype.updatePiece=function(t,e,o){this.pieces[t].innerHTML=e+":"+o},ConBoard.Head.prototype.update=function(t){var e,o,i=t.hours,n=this.pieces.length;if(t.minutes!==this.minutes&&(this.minutes=t.minutes,o=t.minutes<10?"0"+t.minutes.toString():t.minutes,this.timeEl.innerHTML=ConBoard.DayEnum[t.day]+" "+i+":"+o,this.startTick!==t.startTick)){this.startTick=t.startTick;for(var r=new Date(t.startTick),a=0;n>a;++a)e=r.getMinutes()<10?"0"+r.getMinutes().toString():r.getMinutes(),i=r.getHours(),this.updatePiece(a,i,e),r.setTime(r.getTime()+this.interval)}},window.ConBoard=window.ConBoard||{},ConBoard.Programme=function(t){this.pid=t.pid,this.startTime=t.startTime,this.endTime=t.endTime,this.el=void 0,this.createEl()},ConBoard.Programme.prototype.setDetails=function(t){this.title=t.title,this.author=t.author,this.location=t.location,this.programLine=t.programLine,this.type=t.type,this.annotation=t.annotation,this.updateBody()},ConBoard.Programme.prototype.setWidth=function(t){this.width=t,this.el.style.width=t+"%"},ConBoard.Programme.prototype.updatePosition=function(t){this.position=t,this.el.style.left=t+"%"},ConBoard.Programme.prototype.destroy=function(){this.el.parentNode.removeChild(this.el)},ConBoard.Programme.prototype.createEl=function(){var t=document.createElement("div");t.setAttribute("class","con-board-programme"),t.setAttribute("id","programme-"+this.pid),this.el=t,this.detail=document.createElement("div"),this.detail.setAttribute("class","con-board-programme-detail"),this.detail.innerHTML="Loading...</br>"+this.pid,this.el.appendChild(this.detail)},ConBoard.Programme.prototype.updateBody=function(){this.detail.innerHTML='<span class="con-board-programme-detail-title">'+this.title+'</span><span class="con-board-programme-detail-author">'+this.author+"</span>",this.detail.setAttribute("class",this.detail.getAttribute("class")+" type-"+this.type)},ConBoard.Programme.prototype.getEl=function(){return this.el},window.ConBoard=window.ConBoard||{},ConBoard.Request=function(t,e,o){var i=this;this.xhr=new XMLHttpRequest,this.method=t,this.url=e,this.callback=o,this.xhr.onreadystatechange=function(){i.onStateChange(i.xhr,i.callback)},this.xhr.open(this.method,this.url)},ConBoard.Request.prototype.send=function(){this.xhr.send()},ConBoard.Request.prototype.onStateChange=function(t,e){var o;4===t.readyState&&e(o,t.response)},window.ConBoard=window.ConBoard||{},ConBoard.Timer=function(t){this.interval=t||500,this.listeners=[]},ConBoard.Timer.prototype.Start=function(){this.interval=window.setInterval(this.Tick.bind(this),this.interval),this.Tick()},ConBoard.Timer.prototype.Tick=function(){var t=Date.now(),e=new Date(t),o={tick:t,day:e.getDay(),hours:e.getHours(),minutes:e.getMinutes()};for(var i in this.listeners){var n=this.listeners[i].fn,r=this.listeners[i].scope||window;n.call(r,o)}},ConBoard.Timer.prototype.on=function(t,e){this.listeners.push({fn:t,scope:e})},ConBoard.Timer.prototype.off=function(t,e){for(var o in this.listeners){var i=listeners[o];if(i.fn===t&&e===i.scope)return void listeners.splice(o,1)}},ConBoard.Timer.prototype.Stop=function(){window.clearInterval(this.interval)},window.ConBoard=window.ConBoard||{},ConBoard.Notice=function(t){this.el,this.content,this.start=t.start,this.end=t.end,this.callback=t.callback,this.class=t.class,this.rendered=!1},ConBoard.Notice.prototype.create=function(){this.rendered=!0,this.createMask(),this.createContent(),this.callback(this)},ConBoard.Notice.prototype.getEl=function(){return this.el},ConBoard.Notice.prototype.createContent=function(){this.content=document.createElement("div"),this.content.setAttribute("class","notice"+(this.class?" "+this.class:"")),this.el.appendChild(this.content)},ConBoard.Notice.prototype.setContent=function(t){this.content.innerHTML=t},ConBoard.Notice.prototype.createMask=function(){maskEl=document.createElement("div"),maskEl.setAttribute("class","con-board-body-mask"+(this.class?" "+this.class:"")),this.el=maskEl},ConBoard.Notice.prototype.destroy=function(){this.rendered=!1,this.el.parentNode.removeChild(this.el),delete this.el,delete this.content},ConBoard.Notice.prototype.update=function(){this.callback(this)};