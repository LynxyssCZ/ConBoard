window.ConBoard=window.ConBoard||{};ConBoard.Board=function(a){this.cats=[];this.container=a;this.container.style.width=document.body.clientWidth;this.createHead();this.createBody();this.getCats();this.startTimer()};ConBoard.Board.prototype.DayEnum="Nedele Pondeli Utery Streda Ctvrtek Patek Sobota".split(" ");ConBoard.Board.prototype.createHead=function(){this.head=document.createElement("div");this.head.setAttribute("class","con-board-head");this.container.appendChild(this.head)};
ConBoard.Board.prototype.createBody=function(){this.body=document.createElement("div");this.body.setAttribute("class","con-board-body");this.container.appendChild(this.body)};ConBoard.Board.prototype.updateHead=function(a){10>a.minutes&&(a.minutes="0"+a.minutes.toString());this.head.innerHTML=this.DayEnum[a.day]+" "+a.hours+":"+a.minutes;console.log("Starting interval is",a.hours,a.startMinutes)};ConBoard.Board.prototype.tick=function(a){a.startMinutes=30<a.minutes?30:0;this.updateHead(a);for(var b in this.cats)this.cats[b].update(a.tick)};
ConBoard.Board.prototype.startTimer=function(){this.timer=new ConBoard.Timer;this.timer.Start();this.timer.on(this.tick,this)};ConBoard.Board.prototype.getCats=function(){var a=this;(new ConBoard.Request("GET","/categories",function(b){b=JSON.parse(b);a.loadCats(b)})).send()};ConBoard.Board.prototype.loadCats=function(a){var b=Math.floor(100/a.length),c;for(c in a){var d=new ConBoard.Cat({name:a[c],height:b+"%",width:this.body.clientwidth,id:c,key:"location"});this.cats.push(d);this.body.appendChild(d.getEl())}};window.ConBoard=window.ConBoard||{};ConBoard.Cat=function(a){this.config=a;this.progs=[];this.createEl();this.fillCat()};ConBoard.Cat.prototype.update=function(a){this.body.innerHTML="";0<this.progs.length&&this.progs[0].endTime>a&&(this.progs[0].destroy(),this.progs.splice(0,1));for(var b in this.content)if(a<this.content[b].startTime&&this.content[b]&&this.content[b].startTime>a+72E5){console.log("Some programme is out of timeline");break}};
ConBoard.Cat.prototype.fillCat=function(){var a=this;(new ConBoard.Request("GET","/programmes/"+this.config.key+"/"+this.config.name,function(b){a.content=JSON.parse(b);a.content.sort(function(a,b){return a.startTime<b.startTime?-1:1})})).send()};ConBoard.Cat.prototype.getEl=function(){return this.el};
ConBoard.Cat.prototype.createEl=function(){var a=document.createElement("div");a.setAttribute("class","con-board-cat");a.setAttribute("id","con-board-cat-"+this.config.id);a.style.height=this.config.height;a.style.width=this.config.width;this.el=a;var b=document.createElement("div");b.setAttribute("class","con-board-cat-head");b.innerHTML=this.config.name;this.head=b;var c=document.createElement("div");c.setAttribute("class","con-board-cat-body");this.body=c;this.el.appendChild(b);this.el.appendChild(c);
return a};window.ConBoard=window.ConBoard||{};ConBoard.Programme=function(a){this.pid=a.pid;this.title=a.title;this.startTime=a.startTime;this.endTime=a.endTime;this.author=a.author;this.location=a.location;this.programLine=a.programLine;this.type=a.type;this.annotation=a.annotation;this.el=void 0;this.createEl()};ConBoard.Programme.prototype.load=function(a){};ConBoard.Programme.prototype.destroy=function(){this.el.parentnode.removeChild(this.el)};ConBoard.Programme.prototype.createEl=function(){document.createEl("div")};
ConBoard.Programme.prototype.getEl=function(){return this.el};window.ConBoard=window.ConBoard||{};ConBoard.Request=function(a,b,c){var d=this;this.xhr=new XMLHttpRequest;this.method=a;this.url=b;this.callback=c;this.xhr.onreadystatechange=function(){d.onStateChange(d.xhr,d.callback)};this.xhr.open(this.method,this.url)};ConBoard.Request.prototype.send=function(){this.xhr.send()};ConBoard.Request.prototype.onStateChange=function(a,b){4===a.readyState&&b(a.response)};window.ConBoard=window.ConBoard||{};ConBoard.Timer=function(){this.interval=500;this.listeners=[]};ConBoard.Timer.prototype.Start=function(){this.interval=window.setInterval(this.Tick.bind(this),this.interval)};ConBoard.Timer.prototype.Tick=function(){var a=Date.now(),b=new Date(a),a={tick:a,day:b.getDay(),hours:b.getHours(),minutes:b.getMinutes()},c;for(c in this.listeners)this.listeners[c].fn.call(this.listeners[c].scope||window,a)};
ConBoard.Timer.prototype.on=function(a,b){this.listeners.push({fn:a,scope:b})};ConBoard.Timer.prototype.off=function(a,b){for(var c in this.listeners){var d=listeners[c];if(d.fn===a&&b===d.scope){listeners.splice(c,1);break}}};ConBoard.Timer.prototype.Stop=function(){window.clearInterval(this.interval)};